<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora de Energia Incidente IEEE 1584-2018</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#1e3c72,#2a5298,#3b6fbf);
      min-height:100vh;padding:20px;color:#fff
    }
    .container{max-width:1400px;margin:0 auto}
    .header{text-align:center;margin-bottom:40px}
    .header h1{font-size:3rem;font-weight:700;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.3)}
    .header .subtitle{font-size:1.2rem;color:rgba(255,255,255,.8);margin-bottom:20px}
    .icon{font-size:3rem;margin-bottom:20px}
    .main-grid{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:30px}
    @media (max-width:768px){.main-grid{grid-template-columns:1fr}}
    .panel{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:20px;padding:30px;border:1px solid rgba(255,255,255,.2);box-shadow:0 8px 32px rgba(0,0,0,.1)}
    .panel-header{display:flex;align-items:center;gap:10px;margin-bottom:25px}
    .panel-header h2{font-size:1.8rem;font-weight:600}
    .form-group{margin-bottom:20px}
    .form-group label{display:block;font-weight:600;margin-bottom:8px;font-size:1rem}
    .form-control{
      width:100%;padding:12px 16px;border-radius:10px;border:1px solid rgba(255,255,255,.3);
      background:rgba(255,255,255,.2);color:#fff;font-size:1rem;transition:.3s
    }
    .form-control:focus{outline:none;border-color:#ffd700;box-shadow:0 0 10px rgba(255,215,0,.3)}
    .form-control::placeholder{color:rgba(255,255,255,.7)}
    .btn-group{display:flex;gap:15px;margin-top:25px}
    .btn{flex:1;padding:15px 25px;border:none;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;transition:.3s;display:flex;align-items:center;justify-content:center;gap:8px}
    .btn-primary{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#fff}
    .btn-primary:hover{background:linear-gradient(135deg,#ffed4a,#ff7300);transform:translateY(-2px);box-shadow:0 8px 20px rgba(255,140,0,.3)}
    .btn-secondary{background:rgba(255,255,255,.2);color:#fff}
    .btn-secondary:hover{background:rgba(255,255,255,.3)}
    .result-main{background:linear-gradient(135deg,rgba(220,20,60,.2),rgba(255,69,0,.2));border-radius:15px;padding:30px;text-align:center;margin-bottom:25px;border:1px solid rgba(255,69,0,.3)}
    .result-value{font-size:2.5rem;font-weight:700;margin-bottom:10px}
    .result-label{font-size:1.1rem;color:rgba(255,255,255,.8)}
    .result-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:25px}
    .result-item{background:rgba(255,255,255,.1);border-radius:10px;padding:20px;border:1px solid rgba(255,255,255,.2)}
    .result-item-label{font-size:.9rem;color:rgba(255,255,255,.7);margin-bottom:5px}
    .result-item-value{font-size:1.4rem;font-weight:700}
    .epi-section{background:linear-gradient(135deg,rgba(34,139,34,.2),rgba(0,100,0,.2));border-radius:15px;padding:25px;border:1px solid rgba(34,139,34,.3)}
    .epi-header{display:flex;align-items:center;gap:10px;margin-bottom:15px}
    .epi-description{font-size:1.1rem;font-weight:600}
    .warning-section{background:linear-gradient(135deg,rgba(255,0,0,.2),rgba(139,0,0,.2));border-radius:15px;padding:25px;border:2px solid rgba(255,0,0,.5);margin-top:20px}
    .warning-header{display:flex;align-items:center;gap:10px;margin-bottom:15px;color:#ffcccb}
    .empty-state{text-align:center;padding:60px 20px;color:rgba(255,255,255,.6)}
    .empty-state-icon{font-size:4rem;margin-bottom:20px}
    .info-section{background:rgba(255,255,255,.05);backdrop-filter:blur(5px);border-radius:20px;padding:30px;border:1px solid rgba(255,255,255,.1)}
    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-top:20px}
    @media (max-width:768px){.info-grid{grid-template-columns:1fr}.result-grid{grid-template-columns:1fr}}
    .info-column h4{font-weight:600;margin-bottom:15px;color:#fff}
    .info-column ul{list-style:none;font-size:.9rem;color:rgba(255,255,255,.8)}
    .info-column li{margin-bottom:8px;padding-left:15px;position:relative}
    .info-column li::before{content:"‚Ä¢";position:absolute;left:0;color:#ffd700}
    .calculation-details{background:rgba(255,255,255,.05);border-radius:10px;padding:20px;margin-top:20px;border:1px solid rgba(255,255,255,.1)}
    .calculation-step{margin-bottom:15px;padding:10px;background:rgba(255,255,255,.05);border-radius:8px;font-family:'Courier New',monospace;font-size:.9rem}
    .formula{background:rgba(0,0,0,.2);padding:10px;border-radius:5px;margin:10px 0;font-family:'Courier New',monospace;border-left:3px solid #ffd700}
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="icon">‚ö°</div>
      <h1>Calculadora de Energia Incidente</h1>
      <p class="subtitle">C√°lculo conforme IEEE 1584-2018 ‚Äî com Fronteira de Seguran√ßa (1,2 cal/cm¬≤)</p>
    </div>

    <div class="main-grid">
      <!-- Painel de Entrada -->
      <div class="panel">
        <div class="panel-header">
          <span style="font-size:1.5rem">üßÆ</span><h2>Dados de Entrada</h2>
        </div>

        <div class="form-group">
          <label for="tensao">Tens√£o do Sistema (V)</label>
          <input type="number" id="tensao" class="form-control" placeholder="Ex: 480, 4160, 13800">
        </div>

        <div class="form-group">
          <label for="corrente">Corrente de Curto-Circuito (A)</label>
          <input type="number" id="corrente" class="form-control" placeholder="Ex: 10000, 25000">
        </div>

        <div class="form-group">
          <label for="tempo">Tempo de Arco (s)</label>
          <input type="number" id="tempo" step="0.001" class="form-control" placeholder="Ex: 0.2, 0.5, 1.0">
        </div>

        <div class="form-group">
          <label for="distancia">Dist√¢ncia de Trabalho (mm)</label>
          <input type="number" id="distancia" class="form-control" placeholder="Ex: 610, 910, 1220">
        </div>

        <div class="form-group">
          <label for="gap">Gap entre Condutores (mm)</label>
          <input type="number" id="gap" class="form-control" placeholder="Ex: 25, 32, 76">
        </div>

        <div class="form-group">
          <label for="configuracao">Configura√ß√£o do Equipamento</label>
          <select id="configuracao" class="form-control">
            <option value="vcb">VCB (Vertical Conductor in a Box)</option>
            <option value="hcb">HCB (Horizontal Conductor in a Box)</option>
            <option value="voa">VOA (Vertical Conductor in Open Air)</option>
            <option value="hoa">HOA (Horizontal Conductor in Open Air)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="aterramento">Sistema de Aterramento</label>
          <select id="aterramento" class="form-control">
            <option value="solidly">Solidamente Aterrado</option>
            <option value="ungrounded">N√£o Aterrado</option>
            <option value="high_resistance">Alta Resist√™ncia</option>
          </select>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" id="btn-calcular"><span>üßÆ</span> Calcular</button>
          <button class="btn btn-secondary" id="btn-limpar">Limpar</button>
        </div>
      </div>

      <!-- Painel de Resultados -->
      <div class="panel">
        <div class="panel-header">
          <span style="font-size:1.5rem">üõ°Ô∏è</span><h2>Resultados</h2>
        </div>
        <div id="resultados-container">
          <div class="empty-state">
            <div class="empty-state-icon">‚ÑπÔ∏è</div>
            <p>Preencha os dados e clique em "Calcular" para ver os resultados</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Detalhes dos C√°lculos -->
    <div id="calculation-details" class="panel" style="display:none;">
      <div class="panel-header">
        <span style="font-size:1.5rem">üìê</span><h2>Detalhes dos C√°lculos IEEE 1584-2018</h2>
      </div>
      <div id="calculation-steps"></div>
    </div>

    <!-- Informa√ß√µes Importantes -->
    <div class="info-section">
      <div class="panel-header">
        <span style="font-size:1.5rem">‚ÑπÔ∏è</span><h2>Informa√ß√µes Importantes</h2>
      </div>
      <div class="info-grid">
        <div class="info-column">
          <h4>Categorias de EPI (NFPA 70E)</h4>
          <ul>
            <li><strong>Cat 0:</strong> &lt; 1,2 cal/cm¬≤ - Roupas normais</li>
            <li><strong>Cat 1:</strong> 1,2 - 4 cal/cm¬≤ - FR b√°sico</li>
            <li><strong>Cat 2:</strong> 4 - 8 cal/cm¬≤ - FR + prote√ß√£o facial</li>
            <li><strong>Cat 3:</strong> 8 - 25 cal/cm¬≤ - Conjunto FR</li>
            <li><strong>Cat 4:</strong> 25 - 40 cal/cm¬≤ - FR multi-camadas</li>
          </ul>
        </div>
        <div class="info-column">
          <h4>Dist√¢ncias T√≠picas (NFPA 70E)</h4>
          <ul>
            <li><strong>208-240V:</strong> 610 mm</li>
            <li><strong>480-600V:</strong> 610 mm</li>
            <li><strong>2,4-4,16kV:</strong> 910 mm</li>
            <li><strong>13,8kV:</strong> 1220 mm</li>
            <li><strong>34,5kV:</strong> 1830 mm</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configura√ß√µes do equipamento (k1 conforme tipo/ambiente ‚Äî log En)
    const configuracoes = {
      vcb: { nome:'VCB (Vertical Conductor in a Box)', k1: -0.555 },
      hcb: { nome:'HCB (Horizontal Conductor in a Box)', k1: -0.555 },
      voa: { nome:'VOA (Vertical Conductor in Open Air)', k1: -0.792 },
      hoa: { nome:'HOA (Horizontal Conductor in Open Air)', k1: -0.792 }
    };

    // Expoente de dist√¢ncia x (exemplos t√≠picos usados no seu c√≥digo)
    const fatoresDistancia = {
      baixaTensao: { switchgear: 1.473, mcc_panels: 1.641, cables: 2.000, openAir: 2.000 },
      mediaTensao: { switchgear: 0.973, cables: 2.000, openAir: 2.000 }
    };

    function validarCamposNumericos(...vals){
      return vals.every(v => typeof v === 'number' && isFinite(v) && v > 0);
    }

    function calcular(){
      // Inputs
      const V = parseFloat(document.getElementById('tensao').value);
      const Ibf = parseFloat(document.getElementById('corrente').value);
      const t  = parseFloat(document.getElementById('tempo').value);
      const D  = parseFloat(document.getElementById('distancia').value);
      const G  = parseFloat(document.getElementById('gap').value);
      const config = document.getElementById('configuracao').value;
      const aterramento = document.getElementById('aterramento').value;

      if(!validarCamposNumericos(V,Ibf,t,D,G)){
        alert('Por favor, preencha todos os campos com valores num√©ricos positivos.');
        return;
      }

      const steps = [];
      // ETAPA 1: Convers√µes
      const Vkv = V / 1000;
      const Ibf_ka = Ibf / 1000;
      steps.push(`<strong>ETAPA 1: Convers√µes</strong>`);
      steps.push(`V = ${V} V = ${Vkv.toFixed(3)} kV`);
      steps.push(`Ibf = ${Ibf} A = ${Ibf_ka.toFixed(3)} kA`);
      steps.push(`D = ${D} mm = ${(D/1000).toFixed(3)} m`);

      // ETAPA 2: Corrente de Arco (Ia)
      let Ia, log_Ia;
      steps.push(`<br><strong>ETAPA 2: Corrente de Arco (IEEE 1584-2018)</strong>`);
      if (V < 1000){
        // Baixa tens√£o ‚Äî f√≥rmula dependente de "em caixa" vs "ar livre"
        const K_aux = (config === 'vcb' || config === 'hcb') ? -0.097 : -0.153;
        log_Ia = K_aux + 0.662*Math.log10(Ibf_ka) + 0.0966*Vkv + 0.000526*G
                 + 0.5588*Vkv*Math.log10(Ibf_ka) - 0.00304*G*Math.log10(Ibf_ka);
        Ia = Math.pow(10, log_Ia);
        steps.push(`F√≥rmula para < 1 kV`);
        steps.push(`<div class="formula">lg(Ia) = K + 0.662¬∑lg(Ibf) + 0.0966¬∑V + 0.000526¬∑G + 0.5588¬∑V¬∑lg(Ibf) ‚àí 0.00304¬∑G¬∑lg(Ibf)</div>`);
        steps.push(`K = ${K_aux} (${(config==='vcb'||config==='hcb')?'em caixa':'ar livre'})`);
      } else {
        log_Ia = 0.00402 + 0.983*Math.log10(Ibf_ka);
        Ia = Math.pow(10, log_Ia);
        steps.push(`F√≥rmula para ‚â• 1 kV`);
        steps.push(`<div class="formula">lg(Ia) = 0.00402 + 0.983¬∑lg(Ibf)</div>`);
      }
      steps.push(`lg(Ia) = ${log_Ia.toFixed(4)} ‚Üí Ia = ${Ia.toFixed(3)} kA`);

      // ETAPA 3: Energia normalizada En (J/cm¬≤)
      steps.push(`<br><strong>ETAPA 3: Energia Incidente Normalizada</strong>`);
      const k1 = configuracoes[config].k1;
      let k2;
      switch (aterramento){
        case 'solidly': k2 = -0.113; break;
        case 'ungrounded':
        case 'high_resistance':
        default: k2 = 0; break;
      }
      const log_En = k1 + k2 + 1.081*Math.log10(Ia) + 0.0011*G;
      const En = Math.pow(10, log_En); // J/cm¬≤
      steps.push(`k1 = ${k1} (${(config==='vcb'||config==='hcb')?'em caixa':'ar livre'})`);
      steps.push(`k2 = ${k2} (${aterramento==='solidly'?'solidamente aterrado':'n√£o aterrado/alta resist√™ncia'})`);
      steps.push(`<div class="formula">lg(En) = k1 + k2 + 1.081¬∑lg(Ia) + 0.0011¬∑G</div>`);
      steps.push(`lg(En) = ${log_En.toFixed(4)} ‚Üí En = ${En.toFixed(3)} J/cm¬≤`);

      // ETAPA 4: Cf, x e Energia final E
      steps.push(`<br><strong>ETAPA 4: Energia Incidente Final</strong>`);
      const Cf = (V <= 1000) ? 1.5 : 1.0;

      // Determinar x (expoente de dist√¢ncia) conforme seu mapeamento
      let x;
      if (V <= 1000){
        x = (config==='vcb'||config==='hcb') ? fatoresDistancia.baixaTensao.switchgear : fatoresDistancia.baixaTensao.openAir;
      } else if (V <= 5000){
        x = (config==='vcb'||config==='hcb') ? fatoresDistancia.mediaTensao.switchgear : fatoresDistancia.mediaTensao.openAir;
      } else {
        x = fatoresDistancia.mediaTensao.openAir;
      }

      const E_J = Cf * En * (t/0.2) * Math.pow(610 / D, x); // J/cm¬≤
      const E_cal = E_J * 0.2388; // cal/cm¬≤
      steps.push(`Cf = ${Cf} (faixa de tens√£o ${V<=1000?'‚â§ 1 kV':'> 1 kV'})`);
      steps.push(`x = ${x} (expoente de dist√¢ncia)`);
      steps.push(`<div class="formula">E = Cf ¬∑ En ¬∑ (t/0,2) ¬∑ (610/D)^x</div>`);
      steps.push(`E = ${E_J.toFixed(3)} J/cm¬≤ ‚Üí ${E_cal.toFixed(2)} cal/cm¬≤`);

      if (!isFinite(E_cal) || E_cal < 0){ alert('Erro no c√°lculo. Verifique os valores.'); return; }

      // ETAPA 5: Fronteira de seguran√ßa (1,2 cal/cm¬≤ = 5,0 J/cm¬≤)
      // Reorganizando: D_fp = 610 / ( (E_target / (Cf*En*(t/0.2)))^(1/x) )
      const E_target_J = 5.0; // 1,2 cal/cm¬≤
      const base = E_target_J / (Cf * En * (t/0.2));
      let D_fp_mm = NaN, D_fp_m = NaN;
      if (base > 0){
        D_fp_mm = 610 / Math.pow(base, 1/x);
        D_fp_m = D_fp_mm / 1000;
      }
      steps.push(`<br><strong>ETAPA 5: Fronteira de Seguran√ßa (1,2 cal/cm¬≤)</strong>`);
      steps.push(`<div class="formula">D_fp = 610 / (E_alvo / (Cf¬∑En¬∑(t/0,2)))^(1/x), com E_alvo = 5,0 J/cm¬≤</div>`);
      steps.push(`D_fp = ${isFinite(D_fp_mm)?D_fp_mm.toFixed(1):'‚Äî'} mm = ${isFinite(D_fp_m)?D_fp_m.toFixed(2):'‚Äî'} m`);

      // EPI recomendado
      let epi;
      if (E_cal < 1.2) epi = 'Categoria 0 - Roupas de trabalho normais';
      else if (E_cal < 4) epi = 'Categoria 1 - FR b√°sico, capacete, √≥culos';
      else if (E_cal < 8) epi = 'Categoria 2 - FR + prote√ß√£o facial';
      else if (E_cal < 25) epi = 'Categoria 3 - Conjunto FR completo';
      else if (E_cal < 40) epi = 'Categoria 4 - FR multi-camadas';
      else epi = 'PERIGO EXTREMO - Considere desenergizar o equipamento';

      // Exibir resultados
      mostrarResultados({
        energiaCal: E_cal.toFixed(2),
        energiaJ: E_J.toFixed(2),
        correnteArco: Ia.toFixed(2),
        tensao: V,
        tempo: t,
        distancia: D,
        gap: G,
        configuracao: configuracoes[config].nome,
        fronteiraM: isFinite(D_fp_m) ? D_fp_m.toFixed(2) : '‚Äî'
      }, epi);

      // Exibir passos
      mostrarCalculationDetails(steps);
    }

    function mostrarResultados(resultado, epiRequerido){
      const container = document.getElementById('resultados-container');
      const isPerigoso = parseFloat(resultado.energiaCal) > 40;
      const warningHTML = `
        <div class="warning-section">
          <div class="warning-header"><span style="font-size:1.5rem">‚ö†Ô∏è</span><h4>ATEN√á√ÉO - PERIGO EXTREMO</h4></div>
          <p>Energia incidente muito alta! Considere desenergizar o equipamento ou implementar medidas de prote√ß√£o adicionais.</p>
        </div>`;

      container.innerHTML = `
        <div class="result-main">
          <div class="result-value">${resultado.energiaCal} cal/cm¬≤</div>
          <div class="result-label">Energia Incidente</div>
          <div style="font-size:.9rem;margin-top:5px;opacity:.7">(${resultado.energiaJ} J/cm¬≤)</div>
        </div>

        <div class="result-grid">
          <div class="result-item">
            <div class="result-item-label">Corrente de Arco</div>
            <div class="result-item-value">${resultado.correnteArco} kA</div>
          </div>
          <div class="result-item">
            <div class="result-item-label">Tens√£o</div>
            <div class="result-item-value">${resultado.tensao} V</div>
          </div>
          <div class="result-item">
            <div class="result-item-label">Tempo de Arco</div>
            <div class="result-item-value">${resultado.tempo} s</div>
          </div>
          <div class="result-item">
            <div class="result-item-label">Dist√¢ncia</div>
            <div class="result-item-value">${resultado.distancia} mm</div>
          </div>

          <!-- Fronteira de Seguran√ßa em destaque, ocupando a linha inteira -->
          <div class="result-item" style="grid-column:1 / -1; border:1px solid rgba(255,215,0,.5); background:rgba(255,215,0,.15)">
            <div class="result-item-label">Fronteira de Seguran√ßa (1,2 cal/cm¬≤)</div>
            <div class="result-item-value" style="font-size:1.6rem">${resultado.fronteiraM} m</div>
          </div>
        </div>

        <div class="epi-section">
          <div class="epi-header"><span style="font-size:1.2rem">‚ö†Ô∏è</span><h4>EPI Requerido</h4></div>
          <div class="epi-description">${epiRequerido}</div>
        </div>

        ${isPerigoso ? warningHTML : '' }
      `;
    }

    function mostrarCalculationDetails(steps){
      const container = document.getElementById('calculation-details');
      const stepsContainer = document.getElementById('calculation-steps');
      container.style.display = 'block';
      stepsContainer.innerHTML = `
        <div class="calculation-details">
          ${steps.map(s=>`<div class="calculation-step">${s}</div>`).join('')}
        </div>`;
    }

    function limpar(){
      // Limpa campos
      ['tensao','corrente','tempo','distancia','gap'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('configuracao').selectedIndex = 0;
      document.getElementById('aterramento').selectedIndex = 0;

      // Estado inicial de resultados
      document.getElementById('resultados-container').innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">‚ÑπÔ∏è</div>
          <p>Preencha os dados e clique em "Calcular" para ver os resultados</p>
        </div>`;
      // Esconde detalhes
      const det = document.getElementById('calculation-details');
      det.style.display = 'none';
      document.getElementById('calculation-steps').innerHTML = '';
    }

    // Handlers
    document.getElementById('btn-calcular').addEventListener('click', (e)=>{ e.preventDefault(); calcular(); });
    document.getElementById('btn-limpar').addEventListener('click', (e)=>{ e.preventDefault(); limpar(); });
  </script>
</body>
</html>
