<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>App Energia Incidente - IEEE 1584 + Barreiras</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4faff; margin: 0; color: #203060;}
        h1, h2 { color: #0956c0; }
        .container { max-width: 900px; margin: 24px auto; background: #fff; border-radius: 16px; padding: 32px; box-shadow: 0 8px 32px #1750a21a;}
        label { display: block; margin: 16px 0 8px; font-weight: 600;}
        input, select { padding: 8px; border: 1px solid #aad4ff; border-radius: 6px; width: 100%; box-sizing: border-box;}
        button { background: #0956c0; color: #fff; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 24px;}
        button:hover { background: #063a80;}
        .barriers-list { display: flex; gap: 32px; margin-bottom: 20px;}
        .barrier { background: #eaf3ff; border-radius: 12px; padding: 18px; flex: 1;}
        .barrier input { margin-right: 8px; }
        .result { margin: 28px 0 20px; font-size: 1.1em; }
        .scale-bar { width: 100%; height: 34px; margin: 20px 0; background: linear-gradient(90deg, #e5f8e6 0%, #ffd36b 65%, #ff8484 100%); border-radius: 12px; position: relative;}
        .scale-indicator { position: absolute; top: -12px; width: 2px; height: 60px; background: #0956c0;}
        .epi-table { width: 100%; border-collapse: collapse; margin: 24px 0;}
        .epi-table th, .epi-table td { border: 1px solid #cbe3fa; padding: 8px 10px;}
        .epi-table th { background: #eaf3ff;}
        .memorial { background: #f7faff; border-radius: 12px; padding: 18px 24px; margin: 18px 0;}
        .save-btn { float: right; margin-left: 12px;}
        .historico { background: #eef7fc; border-radius: 8px; padding: 12px 16px; margin: 14px 0;}
        .historico-entry { border-bottom: 1px solid #cbe3fa; padding: 6px 0;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Energia Incidente - IEEE 1584 (2018) + Barreiras</h1>
        <form id="incidentForm">
            <label>Tensão (V):</label>
            <input type="number" id="voltage" value="480" required>
            <label>Corrente de Curto (kA):</label>
            <input type="number" step="0.01" id="current" value="25" required>
            <label>Duração do Arco (s):</label>
            <input type="number" step="0.01" id="duration" value="0.2" required>
            <label>Distância do trabalhador (mm):</label>
            <input type="number" id="distance" value="610" required>
            <label>Classe do equipamento:</label>
            <select id="equipClass">
                <option value="low">Baixa tensão &lt; 600V</option>
                <option value="high">Alta tensão ≥ 600V</option>
            </select>
            <button type="button" onclick="calcularEnergia()">Calcular Energia Incidente</button>
        </form>
        
        <!-- Barreiras -->
        <h2>Barreiras de Segurança</h2>
        <div class="barriers-list">
            <div class="barrier">
                <h3>Preventivas</h3>
                <label><input type="checkbox" class="barreira" value="0.6" data-type="preventiva"> Sistema de Detecção de Arco</label>
                <label><input type="checkbox" class="barreira" value="0.5" data-type="preventiva"> Seccionamento Rápido</label>
                <label><input type="checkbox" class="barreira" value="0.7" data-type="preventiva"> Blindagem de Painéis</label>
                <label><input type="checkbox" class="barreira" value="0.85" data-type="preventiva"> Análise de Rotina (APR/JSA)</label>
            </div>
            <div class="barrier">
                <h3>Mitigatórias</h3>
                <label><input type="checkbox" class="barreira" value="0.65" data-type="mitigatoria"> Uso de EPI Adequado</label>
                <label><input type="checkbox" class="barreira" value="0.7" data-type="mitigatoria"> Sinalização e Isolamento</label>
                <label><input type="checkbox" class="barreira" value="0.8" data-type="mitigatoria"> Plano de Resposta à Emergência</label>
            </div>
        </div>
        
        <button type="button" class="save-btn" onclick="salvarAnalise()">Salvar Análise</button>
        
        <!-- Resultado -->
        <div class="result" id="result"></div>
        <!-- Escala visual -->
        <div class="scale-bar" id="scaleBar" style="position: relative;">
            <div id="indicator" class="scale-indicator" style="left:0"></div>
            <span style="position:absolute;left:6px;top:36px;font-size:0.9em">0 cal/cm²</span>
            <span style="position:absolute;right:6px;top:36px;font-size:0.9em">>40 cal/cm²</span>
        </div>
        
        <h2>EPIs Recomendados</h2>
        <table class="epi-table">
            <tr><th>Classe de Risco</th><th>Energia Incidente (cal/cm²)</th><th>EPIs Mínimos</th></tr>
            <tr><td>0</td><td>≤ 1.2</td><td>Calça e camisa de algodão, óculos, protetor auricular</td></tr>
            <tr><td>1</td><td>&gt; 1.2 a 4</td><td>Calça e camisa retardante a chamas, luvas, capacete com viseira</td></tr>
            <tr><td>2</td><td>&gt; 4 a 8</td><td>Macacão antichama, proteção facial completa</td></tr>
            <tr><td>3</td><td>&gt; 8 a 25</td><td>Roupas e acessórios classe 3, luvas isolantes, protetor facial e auditivo</td></tr>
            <tr><td>4</td><td>&gt; 25 a 40</td><td>Kit completo classe 4, proteção máxima corpo inteiro</td></tr>
        </table>

        <h2>Memorial de Cálculo</h2>
        <div class="memorial" id="memorial"></div>
        
        <h2>Histórico de Análises</h2>
        <div class="historico" id="historico"></div>
    </div>
    <script>
        function calcularEnergia() {
            // Entradas
            const voltage = parseFloat(document.getElementById('voltage').value);
            const current = parseFloat(document.getElementById('current').value);
            const duration = parseFloat(document.getElementById('duration').value);
            const distance = parseFloat(document.getElementById('distance').value);
            const equipClass = document.getElementById('equipClass').value;

            // Barreiras selecionadas (multiplicam no final, efeito cumulativo)
            const barreiras = Array.from(document.querySelectorAll('.barreira:checked')).map(b=>parseFloat(b.value));
            let fatorBarreiras = 1.0;
            if (barreiras.length > 0) {
                fatorBarreiras = barreiras.reduce((a,b)=>a*b,1);
            }

            // IEEE 1584-2018 simplificado para fins de app (versão real depende de vários fatores)
            // Fórmula base simplificada para baixa tensão, caixa aberta:
            let energia = 0.0093 * current * voltage * duration / Math.pow(distance, 0.65);
            // Ajuste por barreiras:
            const energiaComBarreiras = energia * fatorBarreiras;

            // Limite visual (máximo do gráfico)
            const energiaDisplay = Math.min(energiaComBarreiras, 40);

            // Determinar classe de risco
            let classe, epirisco;
            if (energiaComBarreiras <= 1.2) { classe = 0; epirisco = "Básico";}
            else if (energiaComBarreiras <= 4) { classe = 1; epirisco = "Retardante a chamas";}
            else if (energiaComBarreiras <= 8) { classe = 2; epirisco = "Antichama completo";}
            else if (energiaComBarreiras <= 25) { classe = 3; epirisco = "Classe 3 completo";}
            else if (energiaComBarreiras <= 40) { classe = 4; epirisco = "Classe 4 máximo";}
            else { classe = 5; epirisco = "Zona extrema, evacuar área!";}

            // Descrever barreiras aplicadas
            let barreirasTexto = "";
            if (barreiras.length > 0) {
                barreirasTexto = "<strong>Barreiras aplicadas:</strong> " +
                    Array.from(document.querySelectorAll('.barreira:checked')).map(b=>b.parentElement.innerText.trim()).join("; ");
            } else {
                barreirasTexto = "<em>Nenhuma barreira selecionada.</em>";
            }

            // Exibir resultados
            document.getElementById('result').innerHTML = `
                <strong>Energia incidente estimada:</strong> <span style="color:#0956c0">${energiaComBarreiras.toFixed(2)} cal/cm²</span><br>
                <strong>Classe de risco:</strong> <span style="color:#${classe>2?'e65b5b':'23ac2f'}"> ${classe}</span><br>
                <strong>EPI recomendado:</strong> ${epirisco}<br>
                ${barreirasTexto}
            `;
            // Atualizar escala visual
            const pos = Math.min(energiaDisplay/40, 1) * 100; // 0 a 100%
            document.getElementById('indicator').style.left = `calc(${pos}% - 2px)`;

            // Atualizar memorial de cálculo
            document.getElementById('memorial').innerHTML = `
                <b>Parâmetros:</b> Tensão: ${voltage} V, Corrente de Curto: ${current} kA, Duração do Arco: ${duration} s, Distância: ${distance} mm.<br>
                <b>Fórmula base:</b> EI = 0.0093 x Icc x V x t / D^0.65<br>
                <b>Energia sem barreiras:</b> ${energia.toFixed(2)} cal/cm²<br>
                <b>Fator de barreiras aplicado:</b> ${fatorBarreiras.toFixed(3)}<br>
                <b>Energia incidente final:</b> <span style="color:#0956c0">${energiaComBarreiras.toFixed(2)} cal/cm²</span><br>
                <b>Barreiras:</b> ${barreirasTexto}
            `;
        }

        // Salvar análise
        function salvarAnalise() {
            const resultDiv = document.getElementById('result').innerText || '';
            const memorialDiv = document.getElementById('memorial').innerText || '';
            const historico = JSON.parse(localStorage.getItem('historicoAnaliseEI') || "[]");
            const entry = {
                data: new Date().toLocaleString(),
                resultado: resultDiv,
                memorial: memorialDiv
            };
            historico.unshift(entry);
            localStorage.setItem('historicoAnaliseEI', JSON.stringify(historico.slice(0,15)));
            exibirHistorico();
            alert("Análise salva no histórico local!");
        }

        function exibirHistorico() {
            const historico = JSON.parse(localStorage.getItem('historicoAnaliseEI') || "[]");
            const div = document.getElementById('historico');
            if (historico.length === 0) {
                div.innerHTML = "<em>Nenhuma análise salva ainda.</em>";
                return;
            }
            div.innerHTML = historico.map(h=>
                `<div class='historico-entry'>
                    <b>${h.data}:</b><br>${h.resultado}<br>
                    <details><summary>Memorial</summary><pre style="font-size:0.95em">${h.memorial}</pre></details>
                </div>`
            ).join("");
        }

        // Carregar histórico ao abrir
        window.onload = exibirHistorico;
    </script>
</body>
</html>
