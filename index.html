<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>App Energia Incidente - IEEE 1584 + Fronteira de Segurança</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4faff; margin: 0; color: #203060;}
        h1, h2 { color: #0956c0; }
        .container { max-width: 900px; margin: 24px auto; background: #fff; border-radius: 16px; padding: 32px; box-shadow: 0 8px 32px #1750a21a;}
        label { display: block; margin: 16px 0 8px; font-weight: 600;}
        input, select { padding: 8px; border: 1px solid #aad4ff; border-radius: 6px; width: 100%; box-sizing: border-box;}
        button { background: #0956c0; color: #fff; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 24px;}
        button:hover { background: #063a80;}
        .result { margin: 28px 0 20px; font-size: 1.1em; }
        .scale-bar { width: 100%; height: 34px; margin: 20px 0; background: linear-gradient(90deg, #e5f8e6 0%, #ffd36b 65%, #ff8484 100%); border-radius: 12px; position: relative;}
        .scale-indicator { position: absolute; top: -12px; width: 2px; height: 60px; background: #0956c0;}
        .epi-table { width: 100%; border-collapse: collapse; margin: 24px 0;}
        .epi-table th, .epi-table td { border: 1px solid #cbe3fa; padding: 8px 10px;}
        .epi-table th { background: #eaf3ff;}
        .memorial { background: #f7faff; border-radius: 12px; padding: 18px 24px; margin: 18px 0;}
        .save-btn { float: right; margin-left: 12px;}
        .historico { background: #eef7fc; border-radius: 8px; padding: 12px 16px; margin: 14px 0;}
        .historico-entry { border-bottom: 1px solid #cbe3fa; padding: 6px 0;}
        .highlight { background: #e0f6ff; padding: 2px 8px; border-radius: 4px;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Energia Incidente - IEEE 1584 (2018) + Fronteira de Segurança</h1>
        <form id="incidentForm">
            <label>Tensão (V):</label>
            <input type="number" id="voltage" value="480" required>
            <label>Corrente de Curto (kA):</label>
            <input type="number" step="0.01" id="current" value="25" required>
            <label>Duração do Arco (s):</label>
            <input type="number" step="0.01" id="duration" value="0.2" required>
            <label>Distância do trabalhador (mm):</label>
            <input type="number" id="distance" value="610" required>
            <label>Classe do equipamento:</label>
            <select id="equipClass">
                <option value="low">Baixa tensão &lt; 600V</option>
                <option value="high">Alta tensão ≥ 600V</option>
            </select>
            <button type="button" onclick="calcularEnergia()">Calcular Energia Incidente</button>
        </form>

        <button type="button" style="margin-left:0;" onclick="calcularFronteira()">Calcular Fronteira de Segurança (1,2 cal/cm²)</button>
        
        <!-- Resultado -->
        <div class="result" id="result"></div>
        <div id="fronteira"></div>
        
        <!-- Escala visual -->
        <div class="scale-bar" id="scaleBar" style="position: relative;">
            <div id="indicator" class="scale-indicator" style="left:0"></div>
            <span style="position:absolute;left:6px;top:36px;font-size:0.9em">0 cal/cm²</span>
            <span style="position:absolute;right:6px;top:36px;font-size:0.9em">>40 cal/cm²</span>
        </div>
        
        <h2>EPIs Recomendados</h2>
        <table class="epi-table">
            <tr><th>Classe de Risco</th><th>Energia Incidente (cal/cm²)</th><th>EPIs Mínimos</th></tr>
            <tr><td>0</td><td>≤ 1.2</td><td>Calça e camisa de algodão, óculos, protetor auricular</td></tr>
            <tr><td>1</td><td>&gt; 1.2 a 4</td><td>Calça e camisa retardante a chamas, luvas, capacete com viseira</td></tr>
            <tr><td>2</td><td>&gt; 4 a 8</td><td>Macacão antichama, proteção facial completa</td></tr>
            <tr><td>3</td><td>&gt; 8 a 25</td><td>Roupas e acessórios classe 3, luvas isolantes, protetor facial e auditivo</td></tr>
            <tr><td>4</td><td>&gt; 25 a 40</td><td>Kit completo classe 4, proteção máxima corpo inteiro</td></tr>
        </table>

        <h2>Memorial de Cálculo</h2>
        <div class="memorial" id="memorial"></div>
        
        <h2>Histórico de Análises</h2>
        <div class="historico" id="historico"></div>
    </div>
    <script>
        function calcularEnergia() {
            // Entradas
            const voltage = parseFloat(document.getElementById('voltage').value);
            const current = parseFloat(document.getElementById('current').value);
            const duration = parseFloat(document.getElementById('duration').value);
            const distance = parseFloat(document.getElementById('distance').value);

            // IEEE 1584-2018 simplificado
            let energia = 0.0093 * current * voltage * duration / Math.pow(distance, 0.65);

            // Limite visual (máximo do gráfico)
            const energiaDisplay = Math.min(energia, 40);

            // Determinar classe de risco
            let classe, epirisco;
            if (energia <= 1.2) { classe = 0; epirisco = "Básico";}
            else if (energia <= 4) { classe = 1; epirisco = "Retardante a chamas";}
            else if (energia <= 8) { classe = 2; epirisco = "Antichama completo";}
            else if (energia <= 25) { classe = 3; epirisco = "Classe 3 completo";}
            else if (energia <= 40) { classe = 4; epirisco = "Classe 4 máximo";}
            else { classe = 5; epirisco = "Zona extrema, evacuar área!";}

            document.getElementById('result').innerHTML = `
                <strong>Energia incidente estimada:</strong> <span style="color:#0956c0">${energia.toFixed(2)} cal/cm²</span><br>
                <strong>Classe de risco:</strong> <span style="color:#${classe>2?'e65b5b':'23ac2f'}"> ${classe}</span><br>
                <strong>EPI recomendado:</strong> ${epirisco}
            `;
            document.getElementById('fronteira').innerHTML = "";

            // Atualizar escala visual
            const pos = Math.min(energiaDisplay/40, 1) * 100;
            document.getElementById('indicator').style.left = `calc(${pos}% - 2px)`;

            // Atualizar memorial de cálculo
            document.getElementById('memorial').innerHTML = `
                <b>Parâmetros:</b> Tensão: ${voltage} V, Corrente de Curto: ${current} kA, Duração do Arco: ${duration} s, Distância: ${distance} mm.<br>
                <b>Fórmula base:</b> EI = 0.0093 × Icc × V × t / D^0.65<br>
                <b>Energia incidente:</b> <span style="color:#0956c0">${energia.toFixed(2)} cal/cm²</span>
            `;
        }

        // Calcular fronteira de segurança (Flash Protection Boundary)
        function calcularFronteira() {
            const voltage = parseFloat(document.getElementById('voltage').value);
            const current = parseFloat(document.getElementById('current').value);
            const duration = parseFloat(document.getElementById('duration').value);
            // Energia alvo: 1,2 cal/cm² (limite de queimadura 2º grau)
            const energiaAlvo = 1.2;

            // D = [0.0093 × Icc × V × t / EI]^(1/0.65)
            let numerador = 0.0093 * current * voltage * duration;
            let D = Math.pow(numerador / energiaAlvo, 1/0.65);

            document.getElementById('fronteira').innerHTML = `
                <div class="highlight">
                    <b>Fronteira de segurança:</b> <span style="color:#0956c0">${D.toFixed(0)} mm</span> 
                    (${(D/1000).toFixed(2)} m) para 1,2 cal/cm²<br>
                    <small>Esta é a distância mínima recomendada para delimitação de áreas de acesso seguro durante o trabalho (IEEE 1584-2018).</small>
                </div>
            `;
        }

        // Salvar análise
        function salvarAnalise() {
            const resultDiv = document.getElementById('result').innerText || '';
            const memorialDiv = document.getElementById('memorial').innerText || '';
            const fronteiraDiv = document.getElementById('fronteira').innerText || '';
            const historico = JSON.parse(localStorage.getItem('historicoAnaliseEI') || "[]");
            const entry = {
                data: new Date().toLocaleString(),
                resultado: resultDiv,
                memorial: memorialDiv,
                fronteira: fronteiraDiv
            };
            historico.unshift(entry);
            localStorage.setItem('historicoAnaliseEI', JSON.stringify(historico.slice(0,15)));
            exibirHistorico();
            alert("Análise salva no histórico local!");
        }

        function exibirHistorico() {
            const historico = JSON.parse(localStorage.getItem('historicoAnaliseEI') || "[]");
            const div = document.getElementById('historico');
            if (historico.length === 0) {
                div.innerHTML = "<em>Nenhuma análise salva ainda.</em>";
                return;
            }
            div.innerHTML = historico.map(h=>
                `<div class='historico-entry'>
                    <b>${h.data}:</b><br>${h.resultado}<br>${h.fronteira}
                    <details><summary>Memorial</summary><pre style="font-size:0.95em">${h.memorial}</pre></details>
                </div>`
            ).join("");
        }

        window.onload = exibirHistorico;
    </script>
</body>
</html>
